<!DOCTYPE html>
<html>
	<head>
	<title>FeedMe! by Hungry Bunch</title>
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<!-- Stylesheets -->
	<link rel="stylesheet" href="http://code.jquery.com/mobile/1.0/jquery.mobile-1.0.min.css" />
	<link rel="stylesheet" type="text/css" href="styles/styles.css" />
	<!-- Scripts -->
	<script type="text/javascript" src="http://code.jquery.com/jquery-1.6.4.min.js"></script>
	<script type="text/javascript" src="http://code.jquery.com/mobile/1.0/jquery.mobile-1.0.min.js"></script>
    <script type="text/javascript" src="scripts/lib/handlebars-1.0.0.beta.6.js"></script>
    <script type="text/javascript" src="scripts/lib/underscore.js"></script>
    <script type="text/javascript" src="scripts/lib/json2.js"></script>
    <script type="text/javascript" src="scripts/lib/backbone.js"></script>
    <script type="text/javascript" src="scripts/lib/backbone.localStorage.js"></script>
	<script type="text/javascript" src="scripts/scripts.js"></script>
	<script type="text/javascript" src="scripts/lscache.js"></script>

	<script>
		(function() {

			// Placeholder for templates
			var Templates = {};

			var restaurants, days;

			// Models
	        var Day = Backbone.Model.extend ({
	          name : '',
	          meals : []
	        });
	        var Restaurant = Backbone.Model.extend ({
	          name : '',
	          days : []
	        });

	        // Collections
	        var Days  = Backbone.Collection.extend ({
	          model: Day,
	        });
	        var Restaurants = Backbone.Collection.extend ({
	          model: Restaurant,
	          localStorage: new Backbone.LocalStorage("Restaurants")
	        });


			var fixgeometry = function() {
			  scroll(0, 0);

			  /* Calculate the geometry that our content area should take */
			  var header = $(".header:visible");
			  var footer = $(".footer:visible");
			  var content = $(".content:visible");
			  var viewport_height = $(window).height();
			  
			  var content_height = viewport_height - header.outerHeight() - footer.outerHeight();
			  
			  /* Trim margin/border/padding height */
			  content_height -= (content.outerHeight() - content.height());
			  content.height(content_height);
			}; /* fixgeometry */

			$(document).ready(function () {
				$(window).bind("orientationchange resize pageshow", fixgeometry);

				// Compile templates
	 	        $('script[type="text/x-handlebars-template"]').each(function () {
	            	Templates[this.id] = Handlebars.compile($(this).html());
	  			});

	  			// View for rendering a day's meals for a chosen restaurant
		        var DayView = Backbone.View.extend ({
		            tagName: "li",
		            events: {
		              "click a.start" : "setStartTime",
					},
		            initialize: function() { 
		              this.model.bind('change', this.render, this);
		              this.template = Templates.restaurants;  
		            },
		            render: function() { 
		              $(this.el).html( this.template(this.model.toJSON()) ); 
		              return this; 
		            });
				});

	  			// View for rendering one restaurant in a list of restaurants
		        var RestaurantView = Backbone.View.extend ({
		            tagName: "li",
		            events: {
		              "click a.start" : "setStartTime",
					},
		            initialize: function() { 
		              this.model.bind('change', this.render, this);
		              this.template = Templates.restaurants;  
		            },
		            render: function() { 
		              $(this.el).html( this.template(this.model.toJSON()) ); 
		              return this; 
		            });
				});

		        // View for rendering the menu (list of days)
		        var DaysListView = Backbone.View.extend ({
		            el: $("#daysList"),
		            events: {
		            },
		            initialize: function() {
		              this.collection.bind('reset', this.render, this);
		              this.collection.bind('all', this.render, this);
		            },
		            render: function() {
		              var el = this.$el;
		              el.empty();
		              this.collection.each(function(item) {
		                var itemView = new DayView({model: day});
		                el.append(itemView.render().el);
		              });
		              this.$el.listview('refresh');
		              return this;
		            }
	          	});


		        // View for rendering the list of entries
		        var RestaurantsListView = Backbone.View.extend ({
		            el: $("#restaurantsList"),
		            events: {
		            },
		            initialize: function() {
		              this.collection.bind('reset', this.render, this);
		              this.collection.bind('all', this.render, this);
		            },
		            render: function() {
		              var el = this.$el;
		              el.empty();
		              this.collection.each(function(item) {
		                var itemView = new RestaurantView({model: restaurant});
		                el.append(itemView.render().el);
		              });
		              this.$el.listview('refresh');
		              return this;
		            }
	          	});

				days = new Days();
				restaurants = new Restaurants();

		    	//Instantiate the views
		    	var daysView = new RestaurantView({collection: restaurants});
		    	var restaurantsView = new RestaurantView({collection: restaurants});
	      })();
	</script>
</head>
<body>
	<div data-role="page">
		<div class="header" data-role="header">
			<h1>FeedMe!</h1>
		</div><!-- /header -->
		<div class='content' data-role='content'> 
			<ul data-role="listview" data-inset="true" data-filter="false">
				<li><a href="#">Täffä</a></li>
				<li><a href="#">Teekkariravintolat</a></li>
				<li><a href="#">Cantina</a></li>
				<li><a href="#">Kvarkki</a></li>
				<li><a href="#">Tuas</a></li>
			</ul>
        </div> 
		<div class="footer" data-role="footer">		
			<div data-role="navbar">
				<ul>
					<li><a href="#">Favorites</a></li>
					<li><a href="#">Menus</a></li>
					<li><a href="#" class="ui-btn-active">Restaurants</a></li>
				</ul>
			</div><!-- /navbar -->
		</div><!-- /footer -->
	</div><!-- /page -->
</body>
</html>